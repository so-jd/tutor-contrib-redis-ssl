# Update Celery broker URL to use configurable transport
CELERY_BROKER_URL = f"{{ REDIS_TRANSPORT }}://{% if REDIS_USERNAME and REDIS_PASSWORD %}{{ REDIS_USERNAME }}:{{ REDIS_PASSWORD }}@{% endif %}{{ REDIS_HOST }}:{{ REDIS_PORT }}/{{ OPENEDX_CELERY_REDIS_DB }}"

# Override all cache locations to use configurable transport
for cache_name in ["default", "general", "mongo_metadata_inheritance", "configuration", "celery", "course_structure_cache", "ora2-storage"]:
    if cache_name in CACHES:
        location = CACHES[cache_name]["LOCATION"]
        if location.startswith("redis://"):
            CACHES[cache_name]["LOCATION"] = location.replace("redis://", "{{ REDIS_TRANSPORT }}://", 1)